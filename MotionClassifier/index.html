<!doctype html>
  <html lang="en">
    <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      
      <!-- Bootstrap CSS -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      
      <!-- use p5 ble js -->
      <script src="https://unpkg.com/p5ble@0.0.4/dist/p5.ble.js"></script>

      <title>Action Classifier</title>

    </head>

    <body>
      <!-- Bootstrap Bundle with Popper -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
      <h1>Action Classifier</h1>
      <p>Click the button to connect to a BLE device</p>
      <p><button onclick="connectToBle()">Connect</button></p>
      <div id="actionDiv">Action: none</div>

      <script>
        //set up
        //set this to the service uuid of your device
        const serviceUuid = "19b10010-e8f2-537e-4f6c-d104768a1214";
        let actionCharacteristic;
        let myBLE = new p5ble();
        var actionDiv = document.getElementById("actionDiv");
        
        const actions = ["none", "feed", "play"]

        //this function is called when the "connect" button is pressed
        function connectToBle() {
          // Connect to a device by passing the service UUID
          myBLE.connect(serviceUuid, gotCharacteristics);
        }

        // A function that will be called once characteristics are received
        function gotCharacteristics(error, characteristics) {
          if (error) console.log('error: ', error);
          console.log('characteristics: ', characteristics);
          actionCharacteristic = characteristics[0];
          myBLE.startNotifications(actionCharacteristic, handleNotifications);
          // Read the value of the first characteristic
          
        }
        function handleNotifications(data) {
          console.log('value: ', data);
          actionDiv.innerHTML = "action: " + actions[data];
        }

      </script>
    </body>
  </html>